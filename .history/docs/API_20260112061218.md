# Tastefully Stained - API Documentation

## Overview

The Tastefully Stained API provides endpoints for watermarking content with C2PA-compliant credentials and blockchain anchoring.

**Base URL:** `http://localhost:8000/api/v1`

## Authentication

API requests require an API key passed in the header:

```http
X-API-Key: your-api-key
```

## Endpoints

### Health Check

```http
GET /health
```

**Response:**
```json
{
  "status": "healthy",
  "version": "0.1.0",
  "service": "tastefully-stained"
}
```

---

### Embed Watermark

```http
POST /watermark/embed
Content-Type: multipart/form-data
```

**Parameters:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| image | file | Yes | Image file (JPEG, PNG, WebP) |
| watermark_data | string | Yes | Data to embed as watermark |
| strategy | string | No | Algorithm: auto, dct, dwt, hybrid |

**Response:**
```json
{
  "success": true,
  "message": "Watermark embedded successfully",
  "watermarked_image_url": "/downloads/abc123.png",
  "watermark_id": "wm_abc123",
  "c2pa_manifest_url": "/manifests/abc123.json",
  "blockchain_tx_hash": null,
  "quality_metrics": {
    "psnr": 45.2,
    "ssim": 0.998
  },
  "processing_time_ms": 1234.56
}
```

---

### Extract Watermark

```http
POST /watermark/extract
Content-Type: multipart/form-data
```

**Parameters:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| image | file | Yes | Watermarked image file |

**Response:**
```json
{
  "success": true,
  "watermark_data": "Original watermark data",
  "confidence": 0.95,
  "strategy_detected": "hybrid"
}
```

---

### Verify Watermark

```http
POST /watermark/verify
Content-Type: multipart/form-data
```

**Parameters:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| image | file | Yes | Image to verify |

**Response:**
```json
{
  "is_valid": true,
  "is_authentic": true,
  "confidence": 0.98,
  "c2pa_verified": true,
  "blockchain_verified": true,
  "tampering_detected": false,
  "verification_details": {}
}
```

---

## Error Responses

All errors follow this format:

```json
{
  "error": "error_code",
  "message": "Human readable message",
  "detail": "Additional details"
}
```

**Error Codes:**
| Code | HTTP Status | Description |
|------|-------------|-------------|
| invalid_request | 400 | Malformed request |
| unauthorized | 401 | Missing or invalid API key |
| not_found | 404 | Resource not found |
| unsupported_format | 415 | Unsupported image format |
| rate_limited | 429 | Too many requests |
| internal_error | 500 | Server error |

---

## Rate Limits

| Endpoint | Limit | Window |
|----------|-------|--------|
| /watermark/embed | 100 | 1 hour |
| /watermark/extract | 500 | 1 hour |
| /watermark/verify | 500 | 1 hour |
| /health | unlimited | - |
